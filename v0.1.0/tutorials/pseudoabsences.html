<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Generating background points · Species Distribution Toolkit</title><meta name="title" content="Generating background points · Species Distribution Toolkit"/><meta property="og:title" content="Generating background points · Species Distribution Toolkit"/><meta property="twitter:title" content="Generating background points · Species Distribution Toolkit"/><meta name="description" content="Documentation for Species Distribution Toolkit."/><meta property="og:description" content="Documentation for Species Distribution Toolkit."/><meta property="twitter:description" content="Documentation for Species Distribution Toolkit."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../index.html"><img src="../assets/logo.svg" alt="Species Distribution Toolkit logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../index.html">Species Distribution Toolkit</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../index.html">Index</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="arithmetic.html">Arithmetic on layers</a></li><li><a class="tocitem" href="statistics.html">Stastistics on layers</a></li><li><a class="tocitem" href="consensus.html">Creating a landcover consensus map</a></li><li><a class="tocitem" href="occlayers.html">Layers and occurrence data</a></li><li class="is-active"><a class="tocitem" href="pseudoabsences.html">Generating background points</a></li><li><a class="tocitem" href="futureclimate.html">Future climate data</a></li></ul></li><li><span class="tocitem">How-to...</span><ul><li><a class="tocitem" href="../howto/get_gbif_data.html">... get data from GBIF?</a></li><li><a class="tocitem" href="../howto/know_layers_provided.html">... know which layers are provided?</a></li><li><a class="tocitem" href="../howto/mask_a_layer.html">... mask a layer?</a></li><li><a class="tocitem" href="../howto/split_a_layer.html">... split a layer in tiles?</a></li><li><a class="tocitem" href="../howto/interpolate.html">... interpolate to a new projection?</a></li></ul></li><li><span class="tocitem">Documentation</span><ul><li><a class="tocitem" href="../manual/SpeciesDistributionToolkit/index.html">Work with species occurrence data</a></li><li><a class="tocitem" href="../manual/SpeciesDistributionToolkit/gbif.jl.html">Occurrences and layers</a></li><li><a class="tocitem" href="../manual/SpeciesDistributionToolkit/pseudoabsences.html">Pseudo-absences</a></li></ul></li><li><span class="tocitem">Appendix: datasets</span><ul><li><input class="collapse-toggle" id="menuitem-5-1" type="checkbox"/><label class="tocitem" for="menuitem-5-1"><span class="docs-label">BiodiversityMapping</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../datasets/BiodiversityMapping/AmphibianRichness.html">AmphibianRichness</a></li><li><a class="tocitem" href="../datasets/BiodiversityMapping/BirdRichness.html">BirdRichness</a></li><li><a class="tocitem" href="../datasets/BiodiversityMapping/MammalRichness.html">MammalRichness</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-2" type="checkbox"/><label class="tocitem" for="menuitem-5-2"><span class="docs-label">CHELSA1</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../datasets/CHELSA1/AverageTemperature.html">AverageTemperature</a></li><li><a class="tocitem" href="../datasets/CHELSA1/BioClim.html">BioClim</a></li><li><a class="tocitem" href="../datasets/CHELSA1/MaximumTemperature.html">MaximumTemperature</a></li><li><a class="tocitem" href="../datasets/CHELSA1/MinimumTemperature.html">MinimumTemperature</a></li><li><a class="tocitem" href="../datasets/CHELSA1/Precipitation.html">Precipitation</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-3" type="checkbox"/><label class="tocitem" for="menuitem-5-3"><span class="docs-label">CHELSA2</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../datasets/CHELSA2/AverageTemperature.html">AverageTemperature</a></li><li><a class="tocitem" href="../datasets/CHELSA2/BioClim.html">BioClim</a></li><li><a class="tocitem" href="../datasets/CHELSA2/MaximumTemperature.html">MaximumTemperature</a></li><li><a class="tocitem" href="../datasets/CHELSA2/MinimumTemperature.html">MinimumTemperature</a></li><li><a class="tocitem" href="../datasets/CHELSA2/Precipitation.html">Precipitation</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-4" type="checkbox"/><label class="tocitem" for="menuitem-5-4"><span class="docs-label">EarthEnv</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../datasets/EarthEnv/HabitatHeterogeneity.html">HabitatHeterogeneity</a></li><li><a class="tocitem" href="../datasets/EarthEnv/LandCover.html">LandCover</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-5" type="checkbox"/><label class="tocitem" for="menuitem-5-5"><span class="docs-label">PaleoClim</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../datasets/PaleoClim/BioClim.html">BioClim</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-6" type="checkbox"/><label class="tocitem" for="menuitem-5-6"><span class="docs-label">WorldClim2</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../datasets/WorldClim2/AverageTemperature.html">AverageTemperature</a></li><li><a class="tocitem" href="../datasets/WorldClim2/BioClim.html">BioClim</a></li><li><a class="tocitem" href="../datasets/WorldClim2/Elevation.html">Elevation</a></li><li><a class="tocitem" href="../datasets/WorldClim2/MaximumTemperature.html">MaximumTemperature</a></li><li><a class="tocitem" href="../datasets/WorldClim2/MinimumTemperature.html">MinimumTemperature</a></li><li><a class="tocitem" href="../datasets/WorldClim2/Precipitation.html">Precipitation</a></li><li><a class="tocitem" href="../datasets/WorldClim2/SolarRadiation.html">SolarRadiation</a></li><li><a class="tocitem" href="../datasets/WorldClim2/WaterVaporPressure.html">WaterVaporPressure</a></li><li><a class="tocitem" href="../datasets/WorldClim2/WindSpeed.html">WindSpeed</a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href="pseudoabsences.html">Generating background points</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="pseudoabsences.html">Generating background points</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/PoisotLab/SpeciesDistributionToolkit.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/PoisotLab/SpeciesDistributionToolkit.jl/blob/main/docs/src/tutorials/pseudoabsences.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Generating-background-points"><a class="docs-heading-anchor" href="#Generating-background-points">Generating background points</a><a id="Generating-background-points-1"></a><a class="docs-heading-anchor-permalink" href="#Generating-background-points" title="Permalink"></a></h1><p>In this vignette, we will generate some background points (pseudo-absences) using the different algorithms present in the package.</p><pre><code class="language-julia hljs">using SpeciesDistributionToolkit
using CairoMakie</code></pre><p>In order to work on a region that is not too big, we will define our spatial extent:</p><pre><code class="language-julia hljs">spatial_extent = (left = 8.412, bottom = 41.325, right = 9.662, top = 43.060)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(left = 8.412, bottom = 41.325, right = 9.662, top = 43.06)</code></pre><p>Pseudo-absence generation requires occurrences super-imposed on a layer, so we will collect a few occurrences:</p><pre><code class="language-julia hljs">species = taxon(&quot;Sitta whiteheadi&quot;; strict = false)
query = [
    &quot;occurrenceStatus&quot; =&gt; &quot;PRESENT&quot;,
    &quot;hasCoordinate&quot; =&gt; true,
    &quot;decimalLatitude&quot; =&gt; (spatial_extent.bottom, spatial_extent.top),
    &quot;decimalLongitude&quot; =&gt; (spatial_extent.left, spatial_extent.right),
    &quot;limit&quot; =&gt; 300,
]
presences = occurrences(species, query...)
for i in 1:3
    occurrences!(presences)
end</code></pre><p>We will get a single layer (temperature) from CHELSA1.</p><pre><code class="language-julia hljs">dataprovider = RasterData(CHELSA1, BioClim)
temperature = 0.1SDMLayer(dataprovider; layer = &quot;BIO1&quot;, spatial_extent...)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">SDM Layer with 14432 Float64 cells
	Proj string: +proj=longlat +datum=WGS84 +no_defs
	Grid size: (209, 151)</code></pre><p>Pseudo-absences generations always starts by masking a layer by the observations. The output of this command is a layer with Boolean values, where the cells in which at least one occurrence is reported are <code>true</code>.</p><pre><code class="language-julia hljs">presencelayer = mask(temperature, presences)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">SDM Layer with 14432 Bool cells
	Proj string: +proj=longlat +datum=WGS84 +no_defs
	Grid size: (209, 151)</code></pre><p>We can for example generate a buffer for pseudo-absences in a radius of 30km around each point. Note that the <code>WithinRadius</code> method uses <em>kilometers</em> and not minutes of arc, so that the actual area is the same regardless of the latitude of the points. Note that the speed of the operation depends on the number of cells with an observation (linearly), and of the radius and raster resolution (to a power of 2). Internally, the code uses a variety of tricks to only look at cells that are susceptible to being pseudo-absences, but the <code>WithinRadius</code> method in particular can take a bit of time.</p><pre><code class="language-julia hljs">background = pseudoabsencemask(WithinRadius, presencelayer; distance = 30.0)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">SDM Layer with 14432 Bool cells
	Proj string: +proj=longlat +datum=WGS84 +no_defs
	Grid size: (209, 151)</code></pre><p>The pseudo-absence generation functions will return a <em>mask</em>, <em>i.e.</em> a boolean layer where the cells in which we can place a pseudo-absence are <code>true</code>, and the rest of the cells are <code>false</code>. This is useful for a variety of reasons, including adding more and more constraints to the locations of pseudo-absences. For example, we can decide that we do not want background points too close to the actual observations, and put a buffer around each.</p><pre><code class="language-julia hljs">buffer = pseudoabsencemask(WithinRadius, presencelayer; distance = 5.0)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">SDM Layer with 14432 Bool cells
	Proj string: +proj=longlat +datum=WGS84 +no_defs
	Grid size: (209, 151)</code></pre><p>We can now exclude the data that are in the buffer:</p><pre><code class="language-julia hljs">bgmask = (! buffer) &amp; background</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">SDM Layer with 14432 Bool cells
	Proj string: +proj=longlat +datum=WGS84 +no_defs
	Grid size: (209, 151)</code></pre><p>Finally, we can plot the area in which we can put pseudo-absences as a shaded region over the layer, and plot all known occurrences as well:</p><pre><code class="language-julia hljs">heatmap(
    temperature;
    colormap = :deep,
    axis = (; aspect = DataAspect()),
    figure = (; resolution = (800, 500)),
)
heatmap!(bgmask; colormap = cgrad([:transparent, :white]; alpha = 0.3))
scatter!(presences; color = :black)
current_figure()</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">┌ Warning: Found `resolution` in the theme when creating a `Scene`. The `resolution` keyword for `Scene`s and `Figure`s has been deprecated. Use `Figure(; size = ...` or `Scene(; size = ...)` instead, which better reflects that this is a unitless size and not a pixel resolution. The key could also come from `set_theme!` calls or related theming functions.
└ @ Makie ~/.julia/packages/Makie/WgbrE/src/scenes.jl:227</code></pre><p><img src="psabs-init.png" alt="Consensus map"/></p><p>There are additional ways to produce pseudo-absences mask, notably the surface range envelope method, which uses the bounding box of observations to allow pseudo-absences:</p><pre><code class="language-julia hljs">sre = pseudoabsencemask(SurfaceRangeEnvelope, presencelayer)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">SDM Layer with 14432 Bool cells
	Proj string: +proj=longlat +datum=WGS84 +no_defs
	Grid size: (209, 151)</code></pre><pre><code class="language-julia hljs">heatmap(
    temperature;
    colormap = :deep,
    axis = (; aspect = DataAspect()),
    figure = (; resolution = (800, 500)),
)
heatmap!(sre; colormap = cgrad([:transparent, :white]; alpha = 0.3))
scatter!(presences; color = :black)
current_figure()</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">┌ Warning: Found `resolution` in the theme when creating a `Scene`. The `resolution` keyword for `Scene`s and `Figure`s has been deprecated. Use `Figure(; size = ...` or `Scene(; size = ...)` instead, which better reflects that this is a unitless size and not a pixel resolution. The key could also come from `set_theme!` calls or related theming functions.
└ @ Makie ~/.julia/packages/Makie/WgbrE/src/scenes.jl:227</code></pre><p><img src="psabs-sre.png" alt="Consensus map"/></p><p>The <code>RandomSelection</code> method (not shown) uses the entire surface of the layer as a possible pseudo-absence location.</p><p>Note that we are not <em>yet</em> generating pseudo-absences, and in order to do so, we need to sample the mask generated by <code>pseudoabsencemask</code>. We can do so using <code>backgroundpoints</code>, which uses the <code>StatsBase.sample</code> function internally.</p><pre><code class="language-julia hljs">bgpoints = backgroundpoints(bgmask, sum(presencelayer))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">SDM Layer with 14432 Bool cells
	Proj string: +proj=longlat +datum=WGS84 +no_defs
	Grid size: (209, 151)</code></pre><p>And finally, we can make a plot:</p><pre><code class="language-julia hljs">heatmap(
    temperature;
    colormap = :deep,
    axis = (; aspect = DataAspect()),
    figure = (; resolution = (800, 500)),
)
heatmap!(bgmask; colormap = cgrad([:transparent, :white]; alpha = 0.3))
scatter!(presences; color = :black)
scatter!(bgpoints; color = :red, markersize = 4)
current_figure()</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">┌ Warning: Found `resolution` in the theme when creating a `Scene`. The `resolution` keyword for `Scene`s and `Figure`s has been deprecated. Use `Figure(; size = ...` or `Scene(; size = ...)` instead, which better reflects that this is a unitless size and not a pixel resolution. The key could also come from `set_theme!` calls or related theming functions.
└ @ Makie ~/.julia/packages/Makie/WgbrE/src/scenes.jl:227</code></pre><p><img src="psabs-final.png" alt="Consensus map"/></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="occlayers.html">« Layers and occurrence data</a><a class="docs-footer-nextpage" href="futureclimate.html">Future climate data »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Friday 13 September 2024 20:41">Friday 13 September 2024</span>. Using Julia version 1.10.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
