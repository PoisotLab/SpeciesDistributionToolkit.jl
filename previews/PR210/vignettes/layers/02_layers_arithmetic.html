<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Layer arithmetic · Species Distribution Toolkit</title><meta name="title" content="Layer arithmetic · Species Distribution Toolkit"/><meta property="og:title" content="Layer arithmetic · Species Distribution Toolkit"/><meta property="twitter:title" content="Layer arithmetic · Species Distribution Toolkit"/><meta name="description" content="Documentation for Species Distribution Toolkit."/><meta property="og:description" content="Documentation for Species Distribution Toolkit."/><meta property="twitter:description" content="Documentation for Species Distribution Toolkit."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../index.html">Species Distribution Toolkit</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../index.html">Index</a></li><li><span class="tocitem">Vignettes</span><ul><li><input class="collapse-toggle" id="menuitem-2-1" type="checkbox" checked/><label class="tocitem" for="menuitem-2-1"><span class="docs-label">Working with layers</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="01_consensus_landcover_map.html">Creating a landcover consensus map</a></li><li class="is-active"><a class="tocitem" href="02_layers_arithmetic.html">Layer arithmetic</a></li><li><a class="tocitem" href="03_working_with_climate_data.html">Working with climate data</a></li><li><a class="tocitem" href="04_creating_masks.html">Creating masks of layers</a></li><li><a class="tocitem" href="05_tiling.html">Splitting layers in tiles</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-2" type="checkbox"/><label class="tocitem" for="menuitem-2-2"><span class="docs-label">Working with occurrences</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../occurrences/01_getting_data_from_gbif.html">Getting data from GBIF</a></li><li><a class="tocitem" href="../occurrences/02_occurrences_and_layers.html">Occurrences and layers</a></li><li><a class="tocitem" href="../occurrences/03_fauxcurrences.html">Generation of fauxcurrences</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-3" type="checkbox"/><label class="tocitem" for="menuitem-2-3"><span class="docs-label">Integration examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../integration/01_statistics_on_layers.html">Statistics on layers</a></li><li><a class="tocitem" href="../integration/02_pseudo_absences.html">Generating background points</a></li></ul></li></ul></li><li><span class="tocitem">List of datasets</span><ul><li><input class="collapse-toggle" id="menuitem-3-1" type="checkbox"/><label class="tocitem" for="menuitem-3-1"><span class="docs-label">CHELSA1</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../datasets/CHELSA1/AverageTemperature.html">AverageTemperature</a></li><li><a class="tocitem" href="../../datasets/CHELSA1/BioClim.html">BioClim</a></li><li><a class="tocitem" href="../../datasets/CHELSA1/MaximumTemperature.html">MaximumTemperature</a></li><li><a class="tocitem" href="../../datasets/CHELSA1/MinimumTemperature.html">MinimumTemperature</a></li><li><a class="tocitem" href="../../datasets/CHELSA1/Precipitation.html">Precipitation</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-2" type="checkbox"/><label class="tocitem" for="menuitem-3-2"><span class="docs-label">CHELSA2</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../datasets/CHELSA2/AverageTemperature.html">AverageTemperature</a></li><li><a class="tocitem" href="../../datasets/CHELSA2/BioClim.html">BioClim</a></li><li><a class="tocitem" href="../../datasets/CHELSA2/MaximumTemperature.html">MaximumTemperature</a></li><li><a class="tocitem" href="../../datasets/CHELSA2/MinimumTemperature.html">MinimumTemperature</a></li><li><a class="tocitem" href="../../datasets/CHELSA2/Precipitation.html">Precipitation</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-3" type="checkbox"/><label class="tocitem" for="menuitem-3-3"><span class="docs-label">EarthEnv</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../datasets/EarthEnv/HabitatHeterogeneity.html">HabitatHeterogeneity</a></li><li><a class="tocitem" href="../../datasets/EarthEnv/LandCover.html">LandCover</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-4" type="checkbox"/><label class="tocitem" for="menuitem-3-4"><span class="docs-label">WorldClim2</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../datasets/WorldClim2/AverageTemperature.html">AverageTemperature</a></li><li><a class="tocitem" href="../../datasets/WorldClim2/BioClim.html">BioClim</a></li><li><a class="tocitem" href="../../datasets/WorldClim2/Elevation.html">Elevation</a></li><li><a class="tocitem" href="../../datasets/WorldClim2/MaximumTemperature.html">MaximumTemperature</a></li><li><a class="tocitem" href="../../datasets/WorldClim2/MinimumTemperature.html">MinimumTemperature</a></li><li><a class="tocitem" href="../../datasets/WorldClim2/Precipitation.html">Precipitation</a></li><li><a class="tocitem" href="../../datasets/WorldClim2/SolarRadiation.html">SolarRadiation</a></li><li><a class="tocitem" href="../../datasets/WorldClim2/WaterVaporPressure.html">WaterVaporPressure</a></li><li><a class="tocitem" href="../../datasets/WorldClim2/WindSpeed.html">WindSpeed</a></li></ul></li></ul></li><li><span class="tocitem">Component packages</span><ul><li><input class="collapse-toggle" id="menuitem-4-1" type="checkbox"/><label class="tocitem" for="menuitem-4-1"><span class="docs-label">SpeciesDistributionToolkit.jl</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../manual/SpeciesDistributionToolkit/index.html">Work with species occurrence data</a></li><li><a class="tocitem" href="../../manual/SpeciesDistributionToolkit/gbif.jl.html">Occurrences and layers</a></li><li><a class="tocitem" href="../../manual/SpeciesDistributionToolkit/pseudoabsences.html">Pseudo-absences</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Phylopic.jl</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../manual/Phylopic/index.html">Integration with Phylopic</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-3" type="checkbox"/><label class="tocitem" for="menuitem-4-3"><span class="docs-label">SimpleSDMLayers.jl</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../manual/SimpleSDMLayers/index.html">Easy manipulation of layers</a></li><li><a class="tocitem" href="../../manual/SimpleSDMLayers/types.html">Layer data representation</a></li><li><a class="tocitem" href="../../manual/SimpleSDMLayers/basics.html">Basic information on layers</a></li><li><a class="tocitem" href="../../manual/SimpleSDMLayers/operations.html">Operations on layers</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-4" type="checkbox"/><label class="tocitem" for="menuitem-4-4"><span class="docs-label">GBIF.jl</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../manual/GBIF/index.html">Interface to GBIF data</a></li><li><a class="tocitem" href="../../manual/GBIF/types.html">GBIF data representation</a></li><li><a class="tocitem" href="../../manual/GBIF/data.html">GBIF data retrieval</a></li><li><a class="tocitem" href="../../manual/GBIF/enums.html">Enumerated query parameters</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-5" type="checkbox"/><label class="tocitem" for="menuitem-4-5"><span class="docs-label">SimpleSDMDatasets.jl</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../manual/SimpleSDMDatasets/index.html">Interface to raster data</a></li><li><a class="tocitem" href="../../manual/SimpleSDMDatasets/dev/types.html">Dataset representation</a></li><li><a class="tocitem" href="../../manual/SimpleSDMDatasets/dev/interface.html">Data retrieval interface</a></li><li><a class="tocitem" href="../../manual/SimpleSDMDatasets/dev/internals.html">Internals</a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Vignettes</a></li><li><a class="is-disabled">Working with layers</a></li><li class="is-active"><a href="02_layers_arithmetic.html">Layer arithmetic</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="02_layers_arithmetic.html">Layer arithmetic</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/PoisotLab/SpeciesDistributionToolkit.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/PoisotLab/SpeciesDistributionToolkit.jl/blob/main/docs/src/vignettes/layers/02_layers_arithmetic.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Layer-arithmetic"><a class="docs-heading-anchor" href="#Layer-arithmetic">Layer arithmetic</a><a id="Layer-arithmetic-1"></a><a class="docs-heading-anchor-permalink" href="#Layer-arithmetic" title="Permalink"></a></h1><p>Layers can be manipulated as any other objects on which you can perform arithmetic. In other words, you can substract, add, multiply, and divide layers, either either with other layers or with numbers. In this vignette, we will take a look at how this can facilitate the creation of a resistance map for functional connectivity analysis.</p><pre><code class="language-julia hljs">using SpeciesDistributionToolkit
using CairoMakie</code></pre><p>We will work on the twelve classes of landcover provided by the <em>EarthEnv</em> data:</p><pre><code class="language-julia hljs">dataprovider = RasterData(EarthEnv, LandCover)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">RasterData{EarthEnv, LandCover}(EarthEnv, LandCover)</code></pre><p>In order to only read what is relevant to our illustration we will define a bounding box over Corsica.</p><pre><code class="language-julia hljs">spatial_extent = (left = 8.412, bottom = 41.325, right = 9.662, top = 43.060)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(left = 8.412, bottom = 41.325, right = 9.662, top = 43.06)</code></pre><p>As a good practice, we check the names of the layers again. Note that checking the name of the layers will <em>not</em> download the data, so this may be a good time to remove some layers you are not interested in (which of course would not be a good idea for this specific application).</p><pre><code class="language-julia hljs">landcover_classes = SimpleSDMDatasets.layers(dataprovider)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">12-element Vector{String}:
 &quot;Evergreen/Deciduous Needleleaf Trees&quot;
 &quot;Evergreen Broadleaf Trees&quot;
 &quot;Deciduous Broadleaf Trees&quot;
 &quot;Mixed/Other Trees&quot;
 &quot;Shrubs&quot;
 &quot;Herbaceous Vegetation&quot;
 &quot;Cultivated and Managed Vegetation&quot;
 &quot;Regularly Flooded Vegetation&quot;
 &quot;Urban/Built-up&quot;
 &quot;Snow/Ice&quot;
 &quot;Barren&quot;
 &quot;Open Water&quot;</code></pre><p>To create a resistance map, we need to decide on a score for the resistance of each class of land use. For the sake of an hypothetical example, we will assume that the species we care about can easily traverse forested habitats, is less fond of shrubs, fields, etc., and is a poor swimmer who is afraid of cities. Think of it as your typical forestry graduate student.</p><pre><code class="language-julia hljs">classes_resistance = [0.1, 0.1, 0.1, 0.2, 0.4, 0.5, 0.7, 0.9, 1.2, 0.8, 1.2, 0.95]
classes_resistance = classes_resistance ./ sum(classes_resistance)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">12-element Vector{Float64}:
 0.013986013986013988
 0.013986013986013988
 0.013986013986013988
 0.027972027972027975
 0.05594405594405595
 0.06993006993006994
 0.0979020979020979
 0.1258741258741259
 0.16783216783216784
 0.1118881118881119
 0.16783216783216784
 0.13286713286713286</code></pre><p>The next step is to download the layers – we do so with a list comprehension, in order to get a vector of layers:</p><pre><code class="language-julia hljs">landuse = [
    SimpleSDMPredictor(dataprovider; layer = class, full = true, spatial_extent...) for
    class in landcover_classes
]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">12-element Vector{SimpleSDMPredictor{UInt8}}:
 SDM predictor → 209×151 grid with 31559 UInt8-valued cells
 SDM predictor → 209×151 grid with 31559 UInt8-valued cells
 SDM predictor → 209×151 grid with 31559 UInt8-valued cells
 SDM predictor → 209×151 grid with 31559 UInt8-valued cells
 SDM predictor → 209×151 grid with 31559 UInt8-valued cells
 SDM predictor → 209×151 grid with 31559 UInt8-valued cells
 SDM predictor → 209×151 grid with 31559 UInt8-valued cells
 SDM predictor → 209×151 grid with 31559 UInt8-valued cells
 SDM predictor → 209×151 grid with 31559 UInt8-valued cells
 SDM predictor → 209×151 grid with 31559 UInt8-valued cells
 SDM predictor → 209×151 grid with 31559 UInt8-valued cells
 SDM predictor → 209×151 grid with 31559 UInt8-valued cells</code></pre><p>The aggregation of the layers is simply ∑wᵢLᵢ, where wᵢ is the resistance of the <em>i</em>-th layer Lᵢ. In order to have the resistance layer expressed between 0 and 1, we finally call the <code>rescale!</code> method with new endpoints for the layer:</p><pre><code class="language-julia hljs">resistance_layer = sum([landuse[i] .* classes_resistance[i] for i in eachindex(landuse)])
rescale!(resistance_layer, (0.0, 1.0));</code></pre><p>The remaining step is to visualize this resistance map, and add a little colorbar to show which areas will be more difficult to cross:</p><pre><code class="language-julia hljs">resistance_map = heatmap(
    resistance_layer;
    colormap = Reverse(:linear_protanopic_deuteranopic_kbjyw_5_95_c25_n256),
    figure = (; resolution = (400, 350)),
    axis = (;
        aspect = DataAspect(),
        xlabel = &quot;Latitude&quot;,
        ylabel = &quot;Longitude&quot;,
        title = &quot;Movement resistance&quot;,
    ),
)
Colorbar(resistance_map.figure[:, end + 1], resistance_map.plot; height = Relative(0.5))
current_figure()</code></pre><img src="02_layers_arithmetic-25ff15d9.png" alt="Example block output"/><p>This layer can then be used in landscape connectivity analyses using <em>e.g.</em> Omniscape.jl.</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="01_consensus_landcover_map.html">« Creating a landcover consensus map</a><a class="docs-footer-nextpage" href="03_working_with_climate_data.html">Working with climate data »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.1.1 on <span class="colophon-date" title="Sunday 15 October 2023 16:14">Sunday 15 October 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
