import{_ as i,c as a,o as t,ag as e}from"./chunks/framework.CVdKYWal.js";const n="/SpeciesDistributionToolkit.jl/v1.3.0/assets/7269918687226182317-sdemo-tuning.v_Rvqx4Y.png",l="/SpeciesDistributionToolkit.jl/v1.3.0/assets/7269918687226182317-partialrespo-bio1.oNUbvteV.png",p="/SpeciesDistributionToolkit.jl/v1.3.0/assets/7269918687226182317-partialresp-surface.DoMeqi0z.png",h="/SpeciesDistributionToolkit.jl/v1.3.0/assets/7269918687226182317-inflated-curve.DvU8N4pN.png",k="/SpeciesDistributionToolkit.jl/v1.3.0/assets/7269918687226182317-uncert-hist.Dub3JOkL.png",r="/SpeciesDistributionToolkit.jl/v1.3.0/assets/7269918687226182317-bio1-effect-map.M9Io_QXn.png",u=JSON.parse('{"title":"Training SDMs with SDeMo","description":"","frontmatter":{},"headers":[],"relativePath":"tutorials/sdemo-introduction.md","filePath":"tutorials/sdemo-introduction.md","lastUpdated":null}'),d={name:"tutorials/sdemo-introduction.md"};function o(A,s,g,c,y,C){return t(),a("div",null,s[0]||(s[0]=[e(`<h1 id="Training-SDMs-with-SDeMo" tabindex="-1">Training SDMs with SDeMo <a class="header-anchor" href="#Training-SDMs-with-SDeMo" aria-label="Permalink to &quot;Training SDMs with SDeMo {#Training-SDMs-with-SDeMo}&quot;">​</a></h1><p>The purpose of this vignette is to take a whistle-stop tour of the what the package has to offer. We will see how to train a model, cross-validate it, select variables, tune hyper-parameters, use bootstraping to measure uncertainty, show partial response curves, calculate varialble importances through bootstraping and Shapley values, and generate counterfactual inputs.</p><div class="tip custom-block"><p class="custom-block-title">Mapping the outputs</p><p>The functions to interact with raster data, and present the outputs of models as maps, are implemented as part of <code>SpeciesDistributionToolkit</code> (<code>SDT</code>). There is a follow-up tutorial that focuses on visualisation of SDM outputs.</p></div><p>This vignette is <em>very terse</em> and is not an introduction to using or interpreting these models!</p><h2 id="Setting-up-the-environment" tabindex="-1">Setting up the environment <a class="header-anchor" href="#Setting-up-the-environment" aria-label="Permalink to &quot;Setting up the environment {#Setting-up-the-environment}&quot;">​</a></h2><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#F85552;--shiki-dark:#E67E80;">using</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> SpeciesDistributionToolkit</span></span>
<span class="line"><span style="--shiki-light:#F85552;--shiki-dark:#E67E80;">using</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> Statistics</span></span>
<span class="line"><span style="--shiki-light:#F85552;--shiki-dark:#E67E80;">using</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> CairoMakie</span></span>
<span class="line"><span style="--shiki-light:#F85552;--shiki-dark:#E67E80;">using</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> PrettyTables</span></span></code></pre></div><p>The package comes with a series of demonstration data, that represent the presences and absences of <em>Sitta whiteheadi</em> at about 1500 locations in Corsica, with 19 bioclim environmental variables:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">X, y </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> SDeMo</span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">.</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">__demodata</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">()</span></span>
<span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">size</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(X)</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span>(19, 1484)</span></span></code></pre></div><h2 id="Setting-up-the-model" tabindex="-1">Setting up the model <a class="header-anchor" href="#Setting-up-the-model" aria-label="Permalink to &quot;Setting up the model {#Setting-up-the-model}&quot;">​</a></h2><p>We will start with an initial model that uses a PCA to transform the data, and then a Naive Bayes Classifier for the classification. Note that this is the partial syntax where we use the default threshold, and all the variables:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">sdm </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;"> SDM</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(MultivariateTransform{PCA}, NaiveBayes, X, y)</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span>PCATransform → NaiveBayes → P(x) ≥ 0.5</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">Transformations</p><p>The transformations will by default <em>only</em> account for the presences. This is motivated by the fact that absences will often be pseudo-absences, and therefore should not be used to transform the data. There are ways to use absences to transform the data as well, which are presented in the <code>SDeMo</code> manual.</p></div><h2 id="Initial-cross-validation" tabindex="-1">Initial cross-validation <a class="header-anchor" href="#Initial-cross-validation" aria-label="Permalink to &quot;Initial cross-validation {#Initial-cross-validation}&quot;">​</a></h2><p>Throughout this demonstration, we will use the same splits between validation and training data, with 10 folds:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">folds </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;"> kfold</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(sdm; k </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;"> 10</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">);</span></span></code></pre></div><p>Using the same splits is important because it will provide a fair basis of comparison for the different models.</p><p>Before starting any manipulation, we can start cross-validating the model: this will return a named tuple with the confusion matrices for validation and training data:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">cv </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;"> crossvalidate</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(sdm, folds);</span></span></code></pre></div><p>The reason why we return the confusion matrices as opposed to directly measuring statistics is that we have more freedom to manipulate the data, without needing to re-run the analysis. For example, we can get the average of a handful of measures on this first step of cross validation:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">measures </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> [mcc, balancedaccuracy, ppv, npv, trueskill, markedness]</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">cvresult </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> [</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">measure</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(set) </span><span style="--shiki-light:#F85552;--shiki-dark:#E67E80;">for</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> measure </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">in</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> measures, set </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">in</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> cv]</span></span>
<span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">pretty_table</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(</span></span>
<span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">    hcat</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">string</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">.(measures), cvresult);</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">    alignment </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> [:l, :c, :c],</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">    backend </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;"> Val</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(:markdown),</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">    header </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> [</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">&quot;Measure&quot;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, </span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">&quot;Validation&quot;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, </span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">&quot;Training&quot;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">],</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">    formatters </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;"> ft_printf</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">&quot;%5.3f&quot;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, [</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">2</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, </span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">3</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">]),</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">)</span></span></code></pre></div><table tabindex="0"><thead><tr><th style="text-align:left;"><strong>Measure</strong></th><th style="text-align:center;"><strong>Validation</strong></th><th style="text-align:center;"><strong>Training</strong></th></tr></thead><tbody><tr><td style="text-align:left;">mcc</td><td style="text-align:center;">0.500</td><td style="text-align:center;">0.502</td></tr><tr><td style="text-align:left;">balancedaccuracy</td><td style="text-align:center;">0.748</td><td style="text-align:center;">0.749</td></tr><tr><td style="text-align:left;">ppv</td><td style="text-align:center;">0.728</td><td style="text-align:center;">0.728</td></tr><tr><td style="text-align:left;">npv</td><td style="text-align:center;">0.777</td><td style="text-align:center;">0.778</td></tr><tr><td style="text-align:left;">trueskill</td><td style="text-align:center;">0.496</td><td style="text-align:center;">0.498</td></tr><tr><td style="text-align:left;">markedness</td><td style="text-align:center;">0.505</td><td style="text-align:center;">0.506</td></tr></tbody></table><p>By default, calling a function to measure model performance (the full list is in the manual) on a series of confusion matrices will return the average. Adding the <code>true</code> argument returns a tuple with the 95% CI:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">mcc</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(cv</span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">.</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">validation, </span><span style="--shiki-light:#35A77C;--shiki-dark:#83C092;">true</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">)</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span>(0.500212923126541, 0.0345215005134967)</span></span></code></pre></div><p>If we want to get a simple idea of what the MCC is for the validation data for all folds, we can use:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">mcc</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">.(cv</span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">.</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">validation)</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span>10-element Vector{Float64}:</span></span>
<span class="line"><span> 0.4696717191074513</span></span>
<span class="line"><span> 0.5397386877160795</span></span>
<span class="line"><span> 0.6021379094024096</span></span>
<span class="line"><span> 0.5472353084585535</span></span>
<span class="line"><span> 0.49917542293938755</span></span>
<span class="line"><span> 0.39904659881877796</span></span>
<span class="line"><span> 0.4581214061975267</span></span>
<span class="line"><span> 0.47514291365887035</span></span>
<span class="line"><span> 0.5137880466878666</span></span>
<span class="line"><span> 0.498071218278486</span></span></code></pre></div><p>The associated confidence interval is</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">ci</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(cv</span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">.</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">validation, mcc)</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span>0.0345215005134967</span></span></code></pre></div><p>Note that cross-validation <em>does not</em> train the model. This is meant to convey the idea that cross-validation is letting us know whether the model is good enough to be trained. If we want to forgo variable selection, we can train the model with</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">train!</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(sdm)</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span>PCATransform → NaiveBayes → P(x) ≥ 0.39</span></span></code></pre></div><h2 id="Variable-selection" tabindex="-1">Variable selection <a class="header-anchor" href="#Variable-selection" aria-label="Permalink to &quot;Variable selection {#Variable-selection}&quot;">​</a></h2><p>We will now select variables using forward selection, but with the added constraint that the first variable (annual mean temperature) must be included:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">forwardselection!</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(sdm, folds, [</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">1</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">])</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span>PCATransform → NaiveBayes → P(x) ≥ 0.342</span></span></code></pre></div><p>This operation <em>will retrain</em> the model. We can now look at the list of selected variables:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">variables</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(sdm)</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span>6-element Vector{Int64}:</span></span>
<span class="line"><span>  1</span></span>
<span class="line"><span>  3</span></span>
<span class="line"><span>  4</span></span>
<span class="line"><span> 17</span></span>
<span class="line"><span> 11</span></span>
<span class="line"><span>  2</span></span></code></pre></div><p>Is this making a difference in terms of cross-validation?</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">cv2 </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;"> crossvalidate</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(sdm, folds)</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">measures </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> [mcc, balancedaccuracy, ppv, npv, trueskill, markedness]</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">cvresult </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> [</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">measure</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(set) </span><span style="--shiki-light:#F85552;--shiki-dark:#E67E80;">for</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> measure </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">in</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> measures, set </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">in</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> cv2]</span></span>
<span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">pretty_table</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(</span></span>
<span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">    hcat</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">string</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">.(measures), cvresult);</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">    alignment </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> [:l, :c, :c],</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">    backend </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;"> Val</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(:markdown),</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">    header </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> [</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">&quot;Measure&quot;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, </span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">&quot;Validation&quot;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, </span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">&quot;Training&quot;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">],</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">    formatters </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;"> ft_printf</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">&quot;%5.3f&quot;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, [</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">2</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, </span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">3</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">]),</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">)</span></span></code></pre></div><table tabindex="0"><thead><tr><th style="text-align:left;"><strong>Measure</strong></th><th style="text-align:center;"><strong>Validation</strong></th><th style="text-align:center;"><strong>Training</strong></th></tr></thead><tbody><tr><td style="text-align:left;">mcc</td><td style="text-align:center;">0.783</td><td style="text-align:center;">0.788</td></tr><tr><td style="text-align:left;">balancedaccuracy</td><td style="text-align:center;">0.895</td><td style="text-align:center;">0.898</td></tr><tr><td style="text-align:left;">ppv</td><td style="text-align:center;">0.835</td><td style="text-align:center;">0.840</td></tr><tr><td style="text-align:left;">npv</td><td style="text-align:center;">0.942</td><td style="text-align:center;">0.941</td></tr><tr><td style="text-align:left;">trueskill</td><td style="text-align:center;">0.790</td><td style="text-align:center;">0.795</td></tr><tr><td style="text-align:left;">markedness</td><td style="text-align:center;">0.777</td><td style="text-align:center;">0.781</td></tr></tbody></table><p>Quite clearly! Before thinking about the relative importance of variables, we will take a look at the thresold.</p><h2 id="Moving-threshold-classification" tabindex="-1">Moving threshold classification <a class="header-anchor" href="#Moving-threshold-classification" aria-label="Permalink to &quot;Moving threshold classification {#Moving-threshold-classification}&quot;">​</a></h2><p>The <code>crossvalidate</code> function comes with an optional argument to specify the threshold between a positive and negative outcome. We can use this to figure out the best possible threshold:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">thresholds </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;"> LinRange</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">0.01</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, </span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">0.99</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, </span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">200</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">)</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">cv3 </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> [</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">crossvalidate</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(sdm, folds; thr </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> t) </span><span style="--shiki-light:#F85552;--shiki-dark:#E67E80;">for</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> t </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">in</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> thresholds];</span></span></code></pre></div><p>We can plot the simplified version of this analysis (averaged across all folds for each value of the threshold):</p><p><img src="`+n+`" alt=""></p><details class="details custom-block"><summary>Code for the figure</summary><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">f </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;"> Figure</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">()</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">ax </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;"> Axis</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(f[</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">1</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, </span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">1</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">]; aspect </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;"> 1</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, xlabel </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;"> &quot;Threshold&quot;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, ylabel </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;"> &quot;MCC&quot;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">)</span></span>
<span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">scatter!</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(ax, thresholds, [</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">mean</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">mcc</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">.(s</span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">.</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">validation)) </span><span style="--shiki-light:#F85552;--shiki-dark:#E67E80;">for</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> s </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">in</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> cv3])</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">ax2 </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;"> Axis</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(f[</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">1</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, </span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">2</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">]; aspect </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;"> 1</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, xlabel </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;"> &quot;Precision&quot;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, ylabel </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;"> &quot;Recall&quot;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">)</span></span>
<span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">scatter!</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">    ax2,</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">    [</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">mean</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(SDeMo</span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">.</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">precision</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">.(s</span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">.</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">validation)) </span><span style="--shiki-light:#F85552;--shiki-dark:#E67E80;">for</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> s </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">in</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> cv3],</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">    [</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">mean</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(SDeMo</span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">.</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">recall</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">.(s</span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">.</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">validation)) </span><span style="--shiki-light:#F85552;--shiki-dark:#E67E80;">for</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> s </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">in</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> cv3],</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">)</span></span>
<span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">xlims!</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(ax, </span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">0.0</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, </span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">1.0</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">)</span></span>
<span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">ylims!</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(ax, </span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">0.0</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, </span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">1.0</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">)</span></span>
<span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">xlims!</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(ax2, </span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">0.0</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, </span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">1.0</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">)</span></span>
<span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">ylims!</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(ax2, </span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">0.0</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, </span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">1.0</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">)</span></span></code></pre></div></details><p>For reference, the threshold at the end of this process is:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">threshold</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(sdm)</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span>0.3416172728167446</span></span></code></pre></div><h2 id="Variable-importance" tabindex="-1">Variable importance <a class="header-anchor" href="#Variable-importance" aria-label="Permalink to &quot;Variable importance {#Variable-importance}&quot;">​</a></h2><p>We can evaluate the importance of each variable by bootstrap, where the values of this variable are randomized, and the absolute value of the difference in model performance is returned (averaged across all folds):</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">varimp </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;"> variableimportance</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(sdm, folds)</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span>6-element Vector{Float64}:</span></span>
<span class="line"><span> 0.2908233859180078</span></span>
<span class="line"><span> 0.1615232959554232</span></span>
<span class="line"><span> 0.029306500075360155</span></span>
<span class="line"><span> 0.04005644294346174</span></span>
<span class="line"><span> 0.2865554214942896</span></span>
<span class="line"><span> 0.004214210884441714</span></span></code></pre></div><p>In relative terms, this is:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">pretty_table</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(</span></span>
<span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">    hcat</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">variables</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(sdm), varimp </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">./</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;"> sum</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(varimp));</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">    alignment </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> [:l, :c],</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">    backend </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;"> Val</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(:markdown),</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">    header </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> [</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">&quot;Variable&quot;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, </span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">&quot;Importance&quot;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">],</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">    formatters </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> (</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">ft_printf</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">&quot;%5.3f&quot;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, </span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">2</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">), </span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">ft_printf</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">&quot;%d&quot;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, </span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">1</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">)),</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">)</span></span></code></pre></div><table tabindex="0"><thead><tr><th style="text-align:left;"><strong>Variable</strong></th><th style="text-align:center;"><strong>Importance</strong></th></tr></thead><tbody><tr><td style="text-align:left;">1</td><td style="text-align:center;">0.358</td></tr><tr><td style="text-align:left;">3</td><td style="text-align:center;">0.199</td></tr><tr><td style="text-align:left;">4</td><td style="text-align:center;">0.036</td></tr><tr><td style="text-align:left;">17</td><td style="text-align:center;">0.049</td></tr><tr><td style="text-align:left;">11</td><td style="text-align:center;">0.353</td></tr><tr><td style="text-align:left;">2</td><td style="text-align:center;">0.005</td></tr></tbody></table><h2 id="Partial-response-curve" tabindex="-1">Partial response curve <a class="header-anchor" href="#Partial-response-curve" aria-label="Permalink to &quot;Partial response curve {#Partial-response-curve}&quot;">​</a></h2><p>Another way to look at the effect of variables is to use the partial response curves. For example, we can look at the predictions of the model between 5 and 15 degrees:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">prx, pry </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;"> partialresponse</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(sdm, </span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">1</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, </span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">LinRange</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">5.0</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, </span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">15.0</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, </span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">100</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">); threshold </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#35A77C;--shiki-dark:#83C092;"> false</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">);</span></span></code></pre></div><p>Note that we use <code>threshold=false</code> to make sure that we look at the score that is returned by the classifier, and not the thresholded version.</p><p><img src="`+l+`" alt=""></p><details class="details custom-block"><summary>Code for the figure</summary><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">f </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;"> Figure</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">()</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">ax </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;"> Axis</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(f[</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">1</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, </span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">1</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">]; xlabel </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;"> &quot;BIO1&quot;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, ylabel </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;"> &quot;Partial response&quot;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">)</span></span>
<span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">lines!</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(ax, prx, pry; color </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> :black)</span></span>
<span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">hlines!</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(ax, [</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">threshold</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(sdm)]; color </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> :red, linestyle </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> :dash)</span></span></code></pre></div></details><p>We can also show the response surface using two variables:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">prx, pry, prz </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;"> partialresponse</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(sdm, </span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">variables</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(sdm)[</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">1</span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">:</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">2</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">]</span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">...</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, (</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">100</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, </span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">100</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">); threshold </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#35A77C;--shiki-dark:#83C092;"> false</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">);</span></span></code></pre></div><p>Note that the last element returned in this case is a two-dimensional array, as it makes sense to visualize the result as a heatmap. Although the idea of a the partial response curves generalizes to more than two dimensions, it is not supported by the package.</p><p><img src="`+p+`" alt=""></p><details class="details custom-block"><summary>Code for the figure</summary><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">f </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;"> Figure</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">()</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">ax </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;"> Axis</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(f[</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">1</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, </span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">1</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">]; xlabel </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;"> &quot;BIO</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">$</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">variables</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">sdm</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">)[</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">1</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">])</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">&quot;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, ylabel </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;"> &quot;BIO</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">$</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">variables</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">sdm</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">)[</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">2</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">])</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">&quot;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">)</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">cm </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;"> heatmap!</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(prx, pry, prz; colormap </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> :Oranges)</span></span>
<span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">Colorbar</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(f[</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">1</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, </span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">2</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">], cm)</span></span></code></pre></div></details><h2 id="Inflated-partial-responses" tabindex="-1">Inflated partial responses <a class="header-anchor" href="#Inflated-partial-responses" aria-label="Permalink to &quot;Inflated partial responses {#Inflated-partial-responses}&quot;">​</a></h2><p>Inflated partial responses replace the average value by other values drawn from different quantiles of the variables:</p><p><img src="`+h+`" alt=""></p><details class="details custom-block"><summary>Code for the figure</summary><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">f </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;"> Figure</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">()</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">ax </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;"> Axis</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(f[</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">1</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, </span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">1</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">])</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">prx, pry </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;"> partialresponse</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(sdm, </span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">1</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">; inflated </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#35A77C;--shiki-dark:#83C092;"> false</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, threshold </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#35A77C;--shiki-dark:#83C092;"> false</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">)</span></span>
<span class="line"><span style="--shiki-light:#F85552;--shiki-dark:#E67E80;">for</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> i </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">in</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;"> 1</span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">:</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">200</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">    ix, iy </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;"> partialresponse</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(sdm, </span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">1</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">; inflated </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#35A77C;--shiki-dark:#83C092;"> true</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, threshold </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#35A77C;--shiki-dark:#83C092;"> false</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">)</span></span>
<span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">    lines!</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(ax, ix, iy; color </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> (:grey, </span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">0.5</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">))</span></span>
<span class="line"><span style="--shiki-light:#F85552;--shiki-dark:#E67E80;">end</span></span>
<span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">lines!</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(ax, prx, pry; color </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> :black, linewidth </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;"> 4</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">)</span></span></code></pre></div></details><h2 id="Measuring-uncertainty-with-bagging" tabindex="-1">Measuring uncertainty with bagging <a class="header-anchor" href="#Measuring-uncertainty-with-bagging" aria-label="Permalink to &quot;Measuring uncertainty with bagging {#Measuring-uncertainty-with-bagging}&quot;">​</a></h2><p>We can wrap our model into an homogeneous ensemble:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">ensemble </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;"> Bagging</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(sdm, </span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">20</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">)</span></span>
<span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">train!</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(ensemble)</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span>{PCATransform → NaiveBayes → P(x) ≥ 0.342} × 20</span></span></code></pre></div><p>Ensemble models can be used in the same way as regular models, but take an extra keyword <code>consensus</code> to indicate how the results from each model should be reconciled. By default, this is the <code>median</code>, but for uncertainty, <code>iqr</code> is a great choice. Note that we use <code>threshold=false</code> because we want to look at the distribution of the score, not the boolean output:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">uncert </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;"> predict</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(ensemble; consensus </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> iqr, threshold </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#35A77C;--shiki-dark:#83C092;"> false</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">);</span></span></code></pre></div><p><img src="`+k+`" alt=""></p><details class="details custom-block"><summary>Code for the figure</summary><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">hist</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(uncert; color </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> :grey, axis </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> (; xlabel </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;"> &quot;Uncertainty (IQR)&quot;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">))</span></span></code></pre></div></details><h2 id="Heterogeneous-ensembles" tabindex="-1">Heterogeneous ensembles <a class="header-anchor" href="#Heterogeneous-ensembles" aria-label="Permalink to &quot;Heterogeneous ensembles {#Heterogeneous-ensembles}&quot;">​</a></h2><p>We can setup an heterogeneous ensemble model by passing several SDMs to <code>Ensemble</code>:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">m1 </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;"> SDM</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(MultivariateTransform{PCA}, NaiveBayes, X, y)</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">m2 </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;"> SDM</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(RawData, BIOCLIM, X, y)</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">m3 </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;"> SDM</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(ZScore, Logistic, X, y)</span></span>
<span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">variables!</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(m2, [</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">1</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, </span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">12</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">])</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">hm </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;"> Ensemble</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(m1, m2, m3)</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span>An ensemble model with:</span></span>
<span class="line"><span>	 PCATransform → NaiveBayes → P(x) ≥ 0.5</span></span>
<span class="line"><span>	 RawData → BIOCLIM → P(x) ≥ 0.01</span></span>
<span class="line"><span>	 ZScore → Logistic → P(x) ≥ 0.5</span></span></code></pre></div><p>We can train this model in the same way:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">train!</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(hm)</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span>An ensemble model with:</span></span>
<span class="line"><span>	 PCATransform → NaiveBayes → P(x) ≥ 0.39</span></span>
<span class="line"><span>	 RawData → BIOCLIM → P(x) ≥ 0.11</span></span>
<span class="line"><span>	 ZScore → Logistic → P(x) ≥ 0.437</span></span></code></pre></div><p>And get predictions:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">predict</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(hm; consensus </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> median, threshold </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#35A77C;--shiki-dark:#83C092;"> false</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">)[</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">1</span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">:</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">10</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">]</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span>10-element Vector{Float64}:</span></span>
<span class="line"><span> 0.8672006562124166</span></span>
<span class="line"><span> 0.6790018398429067</span></span>
<span class="line"><span> 0.03791469194312791</span></span>
<span class="line"><span> 0.6519815836983168</span></span>
<span class="line"><span> 0.85236599060099</span></span>
<span class="line"><span> 0.812006319115324</span></span>
<span class="line"><span> 0.003159557661927437</span></span>
<span class="line"><span> 0.7973629700578904</span></span>
<span class="line"><span> 0.16113744075829395</span></span>
<span class="line"><span> 0.6388281044296372</span></span></code></pre></div><p>Note that the ensemble models (<code>Bagging</code> and <code>Ensemble</code>) are supported by the <code>explain</code>, <code>partialresponse</code>, and <code>counterfactual</code> functions.</p><h2 id="Explaining-predictions" tabindex="-1">Explaining predictions <a class="header-anchor" href="#Explaining-predictions" aria-label="Permalink to &quot;Explaining predictions {#Explaining-predictions}&quot;">​</a></h2><p>We can perform the (MCMC version of) Shapley values measurement, using the <code>explain</code> method:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">[</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">explain</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(sdm, v; observation </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;"> 3</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">) </span><span style="--shiki-light:#F85552;--shiki-dark:#E67E80;">for</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> v </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">in</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;"> variables</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(sdm)]</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span>6-element Vector{Float64}:</span></span>
<span class="line"><span> -0.245</span></span>
<span class="line"><span> -0.06</span></span>
<span class="line"><span> -0.07</span></span>
<span class="line"><span>  0.0</span></span>
<span class="line"><span> -0.21</span></span>
<span class="line"><span>  0.0</span></span></code></pre></div><p>These values are returned as the effect of this variable&#39;s value on the average prediction for this observation.</p><p>We can also produce a figure that looks like the partial response curve, by showing the effect on a variable on each training instance:</p><p><img src="`+r+`" alt=""></p><details class="details custom-block"><summary>Code for the figure</summary><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">f </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;"> Figure</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">()</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">ax </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;"> Axis</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(f[</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">1</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, </span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">1</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">]; xlabel </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;"> &quot;BIO1&quot;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, ylabel </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;"> &quot;Effect on the average prediction&quot;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">)</span></span>
<span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">scatter!</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(ax, </span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">features</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(sdm, </span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">1</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">), </span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">explain</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(sdm, </span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">1</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">; threshold </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#35A77C;--shiki-dark:#83C092;"> true</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">); color </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> :purple)</span></span></code></pre></div></details><h2 id="counterfactuals" tabindex="-1">Counterfactuals <a class="header-anchor" href="#counterfactuals" aria-label="Permalink to &quot;Counterfactuals&quot;">​</a></h2><p>In the final example, we will focus on generating a counterfactual input, <em>i.e.</em> a set of hypothetical inputs that lead the model to predicting the other outcome. Internally, candidate points are generated using the Nelder-Mead algorithm, which works well enough but is not compatible with categorical data.</p><p>We will pick one prediction to flip:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">inst </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;"> 4</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span>4</span></span></code></pre></div><p>And look at its outcome:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">outcome </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;"> predict</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(sdm)[inst]</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span>true</span></span></code></pre></div><p>Our target is expressed in terms of the score we want the counterfactual to reach (and not in terms of true/false, this is very important):</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">target </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> outcome </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">?</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;"> 0.9</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">threshold</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(sdm) </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">:</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;"> 1.1</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">threshold</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(sdm)</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span>0.30745554553507015</span></span></code></pre></div><p>The actual counterfactual is generated as:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">cf </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;"> counterfactual</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">    sdm,</span></span>
<span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">    instance</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(sdm, inst; strict </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#35A77C;--shiki-dark:#83C092;"> false</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">),</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">    target,</span></span>
<span class="line"><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">    200.0</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">;</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">    threshold </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#35A77C;--shiki-dark:#83C092;"> false</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">,</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">)</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span>19-element Vector{Float64}:</span></span>
<span class="line"><span>  13.667091298246762</span></span>
<span class="line"><span>   3.8309525509076607</span></span>
<span class="line"><span>  21.093984453424163</span></span>
<span class="line"><span> 505.7078094230298</span></span>
<span class="line"><span>  16.7</span></span>
<span class="line"><span>  -1.5999999999999996</span></span>
<span class="line"><span>  18.3</span></span>
<span class="line"><span>   5.6000000000000005</span></span>
<span class="line"><span>  13.200000000000001</span></span>
<span class="line"><span>  14.299999999999997</span></span>
<span class="line"><span>   2.420206823383651</span></span>
<span class="line"><span> 924.0</span></span>
<span class="line"><span> 135.0</span></span>
<span class="line"><span>  14.0</span></span>
<span class="line"><span>  48.0</span></span>
<span class="line"><span> 382.0</span></span>
<span class="line"><span>  62.57941112532553</span></span>
<span class="line"><span>  72.0</span></span>
<span class="line"><span> 283.0</span></span></code></pre></div><p>The last value (set to <code>200.0</code> here) is the learning rate, which usually needs to be tuned. The countefactual input for the observation we are interested in is:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">pretty_table</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(</span></span>
<span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">    hcat</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">variables</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(sdm), </span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">instance</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(sdm, inst), cf[</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">variables</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(sdm)]);</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">    alignment </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> [:l, :c, :c],</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">    backend </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;"> Val</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(:markdown),</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">    header </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> [</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">&quot;Variable&quot;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, </span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">&quot;Obs.&quot;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, </span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">&quot;Counterf.&quot;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">],</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">    formatters </span><span style="--shiki-light:#F57D26;--shiki-dark:#E69875;">=</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;"> (</span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">ft_printf</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">&quot;%4.1f&quot;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, [</span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">2</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, </span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">3</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">]), </span><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">ft_printf</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(</span><span style="--shiki-light:#DFA000;--shiki-dark:#DBBC7F;">&quot;%d&quot;</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">, </span><span style="--shiki-light:#DF69BA;--shiki-dark:#D699B6;">1</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">)),</span></span>
<span class="line"><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">)</span></span></code></pre></div><table tabindex="0"><thead><tr><th style="text-align:left;"><strong>Variable</strong></th><th style="text-align:center;"><strong>Obs.</strong></th><th style="text-align:center;"><strong>Counterf.</strong></th></tr></thead><tbody><tr><td style="text-align:left;">1</td><td style="text-align:center;">6.6</td><td style="text-align:center;">13.7</td></tr><tr><td style="text-align:left;">3</td><td style="text-align:center;">21.0</td><td style="text-align:center;">21.1</td></tr><tr><td style="text-align:left;">4</td><td style="text-align:center;">505.1</td><td style="text-align:center;">505.7</td></tr><tr><td style="text-align:left;">17</td><td style="text-align:center;">61.0</td><td style="text-align:center;">62.6</td></tr><tr><td style="text-align:left;">11</td><td style="text-align:center;">0.3</td><td style="text-align:center;">2.4</td></tr><tr><td style="text-align:left;">2</td><td style="text-align:center;">3.8</td><td style="text-align:center;">3.8</td></tr></tbody></table><p>We can check the prediction that would be made on the counterfactual:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#8DA101;--shiki-dark:#A7C080;">predict</span><span style="--shiki-light:#5C6A72;--shiki-dark:#D3C6AA;">(sdm, cf)</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes everforest-light everforest-dark vp-code" tabindex="0"><code><span class="line"><span>false</span></span></code></pre></div><h2 id="conclusion" tabindex="-1">Conclusion <a class="header-anchor" href="#conclusion" aria-label="Permalink to &quot;Conclusion&quot;">​</a></h2><p>This vignette offered a very quick overview of what the <code>SDeMo</code> package does. The integration with the rest of the <code>SpeciesDistributionToolkit</code> ecosystem is detailed in the main documentation.</p>`,126)]))}const v=i(d,[["render",o]]);export{u as __pageData,v as default};
