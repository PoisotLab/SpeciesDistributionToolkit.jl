import{_ as i,o as a,c as t,ag as n}from"./chunks/framework.DsV3aknV.js";const l="/SpeciesDistributionToolkit.jl/dev/assets/5603348265256672553-pca.BFLnArpv.png",B=JSON.parse('{"title":"Multivariate transformations","description":"","frontmatter":{},"headers":[],"relativePath":"howto/multivariate-stats.md","filePath":"howto/multivariate-stats.md","lastUpdated":null}'),e={name:"howto/multivariate-stats.md"};function p(h,s,k,F,r,d){return a(),t("div",null,[...s[0]||(s[0]=[n(`<h1 id="Multivariate-transformations" tabindex="-1">Multivariate transformations <a class="header-anchor" href="#Multivariate-transformations" aria-label="Permalink to &quot;Multivariate transformations {#Multivariate-transformations}&quot;">‚Äã</a></h1><p>The purpose of this vignette is to demonstrate how we can use the <code>MultivariateStats</code> package on layers.</p><p>This functionality is supported through an extension, which is only active when the <code>MultivariateStats</code> package is loaded.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes min-light min-dark has-highlighted vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> SpeciesDistributionToolkit</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> CairoMakie</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> Statistics</span></span>
<span class="line"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> StatsBase</span></span>
<span class="line highlighted"><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> MultivariateStats </span></span></code></pre></div><p>The support is currently limited to PCA</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes min-light min-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">spatial_extent </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> (left </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 8.412</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> bottom </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 41.325</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> right </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 9.662</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> top </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 43.060</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">)</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">dataprovider </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RasterData</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(CHELSA1</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> BioClim)</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">L </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> [</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SDMLayer</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(dataprovider</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> layer </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> i</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> spatial_extent</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">) </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> i </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> [</span><span style="--shiki-light:#1976D2;--shiki-dark:#F8F8F8;">1</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 3</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 8</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 12</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">]]</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes min-light min-dark vp-code" tabindex="0"><code><span class="line"><span>4-element Vector{SDMLayer{Int16}}:</span></span>
<span class="line"><span> üó∫Ô∏è  A 209 √ó 151 layer (14432 Int16 cells)</span></span>
<span class="line"><span> üó∫Ô∏è  A 209 √ó 151 layer (14432 Int16 cells)</span></span>
<span class="line"><span> üó∫Ô∏è  A 209 √ó 151 layer (14432 Int16 cells)</span></span>
<span class="line"><span> üó∫Ô∏è  A 209 √ó 151 layer (14432 Int16 cells)</span></span></code></pre></div><p>We can fit a PCA the &quot;normal&quot; way:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes min-light min-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">M </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fit</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(PCA</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> L</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> maxoutdim</span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#1976D2;--shiki-dark:#F8F8F8;">2</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">)</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes min-light min-dark vp-code" tabindex="0"><code><span class="line"><span>PCA(indim = 4, outdim = 2, principalratio = 0.9861689593337618)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Pattern matrix (unstandardized loadings):</span></span>
<span class="line"><span>StatsBase.CoefTable(Any[[-25.351684398488732, 10.803036653834626, -28.257150860010537, 153.09190256751242], [17.68337136749613, -0.8569279333946745, 23.581494704564843, 7.341384543574963]], [&quot;PC1&quot;, &quot;PC2&quot;], [&quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;], 0, 0)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Importance of components:</span></span>
<span class="line"><span>StatsBase.CoefTable(Any[[24995.01070925078, 0.9510338472239472, 0.9510338472239472, 0.9643721171942471, 0.9643721171942471], [923.4187679218759, 0.03513511210981445, 0.9861689593337617, 0.03562788280575279, 0.9999999999999999]], [&quot;PC1&quot;, &quot;PC2&quot;], [&quot;SS Loadings (Eigenvalues)&quot;, &quot;Variance explained&quot;, &quot;Cumulative variance&quot;, &quot;Proportion explained&quot;, &quot;Cumulative proportion&quot;], 0, 0)</span></span></code></pre></div><p>Note that this will return a <code>PCA</code> result object. We can use it to project a vector of layers:</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes min-light min-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">X </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> predict</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(M</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> L)</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes min-light min-dark vp-code" tabindex="0"><code><span class="line"><span>2-element Vector{SDMLayer{Float64}}:</span></span>
<span class="line"><span> üó∫Ô∏è  A 209 √ó 151 layer (14432 Float64 cells)</span></span>
<span class="line"><span> üó∫Ô∏è  A 209 √ó 151 layer (14432 Float64 cells)</span></span></code></pre></div><p>The last argument <em>must</em> be a vector of layers (or a vector of layers), which will be used as a template to store the output values in.</p><div class="danger custom-block"><p class="custom-block-title">Data leakage</p><p>Transforming the layers before extracting the values of environmental conditions for SDMs creates data leakage and should never be done. <code>SDeMo</code> handles projections the correct way.</p></div><p>We can visualize the result of this projection (first principal component):</p><p><img src="`+l+`" alt=""></p><details class="details custom-block"><summary>Code for the figure</summary><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes min-light min-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">fig</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> ax</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> hm </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> heatmap</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">(</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    X[</span><span style="--shiki-light:#1976D2;--shiki-dark:#F8F8F8;">1</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">]</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    colormap </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> :Spectral</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    figure </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> (</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> size </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> (</span><span style="--shiki-light:#1976D2;--shiki-dark:#F8F8F8;">800</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span><span style="--shiki-light:#1976D2;--shiki-dark:#F8F8F8;"> 400</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">))</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">    axis </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> (</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">;</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;"> aspect </span><span style="--shiki-light:#D32F2F;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> DataAspect</span><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">())</span><span style="--shiki-light:#212121;--shiki-dark:#BBBBBB;">,</span></span>
<span class="line"><span style="--shiki-light:#24292EFF;--shiki-dark:#B392F0;">)</span></span></code></pre></div></details>`,18)])])}const c=i(e,[["render",p]]);export{B as __pageData,c as default};
